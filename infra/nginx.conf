worker_processes auto;

events {
    worker_connections 1024;
}

http {
    # üü¢ 1. ‡πÉ‡∏™‡πà 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏î‡πà‡∏ß‡∏ô! ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ CSS ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏à‡∏∑‡∏î‡∏ä‡∏∑‡∏î)
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # --------------------------------------------------------
    # üõ°Ô∏è 2. Global Settings & Security
    # --------------------------------------------------------
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # üö® ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô 50MB (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå/‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏°‡∏≠‡∏á)
    # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ ‡∏ï‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏∞‡πÄ‡∏à‡∏≠ Error 413 Payload Too Large
    client_max_body_size 50M;

    server {
        listen 80;
        server_name localhost;

        # --------------------------------------------------------
        # üíª 3. Frontend Route (React)
        # --------------------------------------------------------
        location / {
            # üéØ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ Container Name ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠
            proxy_pass http://alzheimer-frontend:3000;
            
            # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö React Hot-Reload (WebSocket)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

        # --------------------------------------------------------
        # ‚öôÔ∏è 4. Backend-Core Routes (API)
        # --------------------------------------------------------
        # ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏£‡∏ß‡∏° 5 Services ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô backend-core ‡πÅ‡∏•‡πâ‡∏ß 
        # ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏£‡∏ß‡∏° (Wildcard) ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå
        
        location /api/ {
            #‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ Container Name
            proxy_pass http://alzheimer-backend:3000;

            # ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IP ‡∏Ç‡∏≠‡∏á User ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Backend ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö Log)
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î Route ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ai-service (Port 5000) ‡∏≠‡∏≠‡∏Å‡∏™‡∏π‡πà‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
        # ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Frontend ‡∏Ñ‡∏ß‡∏£‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà /api/diagnosis ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ backend-core ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö ai-service ‡πÄ‡∏≠‡∏á (‡∏ã‡πà‡∏≠‡∏ô AI ‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
    }
}